<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consumer Dashboard - BlockVerify</title>
    <link href='https://fonts.googleapis.com/css?family=Inter:400,500,600,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="css/modern.css">
    <link rel="stylesheet" href="css/ui-components.css">
</head>
<body>
    <!-- Navigation -->
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="navbar-brand">
                    <i class="fas fa-cube mr-10"></i> BlockVerify
                </a>
                <div class="navbar-menu">
                    <a href="index.html" class="navbar-link">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <a href="manufacturer.html" class="navbar-link">
                        <i class="fas fa-industry"></i> Manufacturer
                    </a>
                    <a href="seller.html" class="navbar-link">
                        <i class="fas fa-store"></i> Seller
                    </a>
                    <a href="consumer.html" class="navbar-link active">
                        <i class="fas fa-user"></i> Consumer
                    </a>
                    <a href="verifyProducts.html" class="navbar-link">
                        <i class="fas fa-search"></i> Verify
                    </a>
                    <div class="user-menu">
                        <span id="welcome-message">Welcome!</span>
                        <a href="#" id="logout-btn" class="btn btn-outline-primary">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Dashboard Header -->
    <section class="page-header">
        <div class="container">
            <h1>Consumer Dashboard</h1>
            <p>Verify product authenticity and view your purchase history</p>
        </div>
    </section>

    <!-- Main Content -->
    <section class="dashboard-section">
        <div class="container">
            <!-- Quick Stats -->
            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-header">
                        <i class="fas fa-shopping-bag"></i>
                        <h3>Total Purchases</h3>
                    </div>
                    <div class="stat-value" id="total-purchases">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <i class="fas fa-check-circle"></i>
                        <h3>Verified Products</h3>
                    </div>
                    <div class="stat-value" id="verified-products">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <i class="fas fa-hourglass-half"></i>
                        <h3>Pending Verifications</h3>
                    </div>
                    <div class="stat-value" id="pending-verifications">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Alerts</h3>
                    </div>
                    <div class="stat-value" id="alerts">-</div>
                </div>
            </div>

            <div class="row mb-40">
                <!-- Product Verification Card -->
                <div class="col-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-search"></i> Verify a Product</h3>
                        </div>
                        <div class="card-body">
                            <p>Scan a QR code or enter a product serial number to verify its authenticity.</p>
                            <a href="verifyProducts.html" class="btn btn-primary">
                                <i class="fas fa-qrcode"></i> Verify Now
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Purchase History Card -->
                <div class="col-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-history"></i> Purchase History</h3>
                        </div>
                        <div class="card-body">
                            <p>View all your previous purchases and their verification status.</p>
                            <button id="view-history-btn" class="btn btn-primary">
                                <i class="fas fa-list"></i> View History
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Purchase History Table -->
            <div class="row mb-40">
                <div class="col-12">
                    <div id="purchase-history-section">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-history"></i> Your Purchase History</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-container">
                                    <div id="purchase-history-loading" class="loading-indicator">
                                        <div class="spinner"></div>
                                        <p>Loading purchase history from blockchain...</p>
                                    </div>
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Product Name</th>
                                                <th>Serial Number</th>
                                                <th>Purchase Date</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="purchase-history-table">
                                            <!-- Purchase history will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Counterfeit Section -->
            <div class="row mb-40">
                <div class="col-12">
                    <div class="card alert-card">
                        <div class="card-header">
                            <h3 class="card-title text-danger"><i class="fas fa-exclamation-triangle"></i> Report Counterfeit Product</h3>
                        </div>
                        <div class="card-body">
                            <p>Found a suspicious product? Report it to help us combat counterfeit products and protect other consumers.</p>
                            <button id="report-btn" class="btn btn-danger">
                                <i class="fas fa-flag"></i> Report Counterfeit
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recently Verified Products -->
            <div class="row">
                <div class="col-12">
                    <div class="section-header">
                        <h2><i class="fas fa-check-circle"></i> Recently Verified Products</h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-4">
                    <div class="card">
                        <img src="https://img.freepik.com/free-photo/wireless-earbuds-with-charging-case_23-2149654329.jpg" alt="Premium Headphones" class="card-img">
                        <div class="card-body">
                            <span class="badge success">Authentic</span>
                            <h3 class="card-title">Premium Headphones</h3>
                            <p>Verified on June 15, 2023</p>
                            <button class="btn btn-sm btn-primary btn-block">
                                <i class="fas fa-eye"></i> View Details
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card">
                        <img src="https://img.freepik.com/free-photo/elegant-watch-with-silver-golden-chain-isolated_181624-27080.jpg" alt="Luxury Watch" class="card-img">
                        <div class="card-body">
                            <span class="badge success">Authentic</span>
                            <h3 class="card-title">Luxury Watch</h3>
                            <p>Verified on May 22, 2023</p>
                            <button class="btn btn-sm btn-primary btn-block">
                                <i class="fas fa-eye"></i> View Details
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card">
                        <img src="https://img.freepik.com/free-photo/woman-holding-trendy-handbag-outdoors_23-2149174127.jpg" alt="Designer Handbag" class="card-img">
                        <div class="card-body">
                            <span class="badge warning">Unverified</span>
                            <h3 class="card-title">Designer Handbag</h3>
                            <p>Purchased on April 10, 2023</p>
                            <button class="btn btn-sm btn-primary btn-block">
                                <i class="fas fa-search"></i> Verify Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal for Report Counterfeit -->
    <div class="modal" id="reportModal">
        <div class="modal-backdrop"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Report Counterfeit Product</h3>
                <button type="button" class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="report-form">
                    <div class="form-group">
                        <label for="product-name">Product Name</label>
                        <input type="text" id="product-name" name="product-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="product-serial">Serial Number</label>
                        <input type="text" id="product-serial" name="product-serial" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-date">Purchase Date</label>
                        <input type="date" id="purchase-date" name="purchase-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="seller-name">Seller Name</label>
                        <input type="text" id="seller-name" name="seller-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="report-reason">Reason for Reporting</label>
                        <select id="report-reason" name="report-reason" class="form-control" required>
                            <option value="">Select a reason</option>
                            <option value="fake">Suspected Fake/Counterfeit</option>
                            <option value="damaged">Product Damaged/Not As Described</option>
                            <option value="unauthorized">Unauthorized Seller</option>
                            <option value="other">Other Reason</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-details">Additional Details</label>
                        <textarea id="report-details" name="report-details" class="form-control" rows="3" placeholder="Please provide more details about the issue"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary close-modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="submit-report">
                    <i class="fas fa-paper-plane"></i> Submit Report
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.5/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@truffle/contract@4.3.19/dist/truffle-contract.min.js"></script>
    <script src="js/login.js"></script>
    <script src="js/consumer.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        $(document).ready(function() {
            // Initialize the blockchain app with consumer type
            BlockchainApp.init('consumer');
            
            // Initialize consumer app
            ConsumerApp.initializeStats();
            
            // Display user information
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            if (currentUser) {
                $('#welcome-message').text('Welcome, ' + currentUser.name + '!');
            } else {
                window.location.href = 'login.html';
            }
            
            // Event handlers
            $('#logout-btn').click(function() {
                logoutUser();
            });
            
            // Initially hide the purchase history section
            $('#purchase-history-section').hide();
            
            // View history button handler
            $('#view-history-btn').click(function() {
                $('#purchase-history-section').slideDown();
                $('#purchase-history-loading').show();
                
                // Simulate loading history from blockchain
                setTimeout(() => {
                    $('#purchase-history-loading').hide();
                    $('#purchase-history-table').html(`
                        <tr>
                            <td>Premium Headphones</td>
                            <td>SN12345678</td>
                            <td>2023-06-15</td>
                            <td><span class="badge success">Authentic</span></td>
                            <td><button class="btn btn-sm btn-primary">View Details</button></td>
                        </tr>
                        <tr>
                            <td>Luxury Watch</td>
                            <td>SN87654321</td>
                            <td>2023-05-22</td>
                            <td><span class="badge success">Authentic</span></td>
                            <td><button class="btn btn-sm btn-primary">View Details</button></td>
                        </tr>
                        <tr>
                            <td>Designer Handbag</td>
                            <td>SN98765432</td>
                            <td>2023-04-10</td>
                            <td><span class="badge warning">Unverified</span></td>
                            <td><button class="btn btn-sm btn-primary">View Details</button></td>
                        </tr>
                    `);
                }, 1500);
            });
            
            // Report counterfeit button handler
            $('#report-btn').click(function() {
                $('#reportModal').show();
            });
            
            $('#submit-report').click(function() {
                // Validate form
                const form = document.getElementById('report-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                // Show submitting state
                $(this).prop('disabled', true).html('<i class="fas fa-circle-notch fa-spin"></i> Submitting...');
                
                // Simulate submission delay
                setTimeout(() => {
                    $('#reportModal').hide();
                    alert('Thank you for your report. Our team will investigate the matter and take appropriate action.');
                    
                    // Reset button state
                    $(this).prop('disabled', false).html('<i class="fas fa-paper-plane"></i> Submit Report');
                    
                    // Reset form
                    $('#report-form')[0].reset();
                }, 1500);
            });
            
            // Close modal buttons
            $('.close-modal').on('click', function() {
                $('.modal').hide();
            });
            
            // Close modal if clicking outside of it
            $(window).on('click', function(event) {
                if ($(event.target).is('.modal')) {
                    $('.modal').hide();
                }
            });
        });
    </script>
</body>
</html>
